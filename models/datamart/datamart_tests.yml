version: 2

models:

  # ==========================================================
  # DATAMART — GOOGLE PLACES NEAREST PARKBEE
  # ==========================================================
  - name: datamart_google_places_nearest_parkbee
    columns:
      - name: place_id
        tests:
          - not_null
          - unique

      - name: google_place_name
        tests:
          - not_null

      - name: parkbee_location_id
        tests:
          - not_null

      - name: distance_meters
        tests:
          - not_null

      - name: distance_category
        tests:
          - not_null

      - name: on_parkbee
        tests:
          - accepted_values:
              values: ['Yes', 'No']

  # ==========================================================
  # DATAMART — PRICE COMPARISON
  # ==========================================================
  - name: datamart_price_comparison_dbt
    columns:
      - name: scrape_date
        tests:
          - not_null

      - name: location_id
        tests:
          - not_null

      - name: hourly_price
        tests:
          - not_null

      - name: price_position
        tests:
          - accepted_values:
              values:
                - 'Public Cheaper'
                - 'ParkBee Cheaper'
                - 'No public parking data'

  # ==========================================================
  # DATAMART — PRICE COMPARISON
  # ==========================================================
  - name: datamart_price_trend
    description: "Hourly parking price trend by location"
    columns:
      - name: country
        tests:
          - not_null

      - name: city
        tests:
          - not_null

      - name: name
        tests:
          - not_null       

      - name: location_id
        tests:
          - not_null
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - location_id
            - parking_from_cet
          severity: warn
